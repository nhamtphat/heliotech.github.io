---
title: 'XoÃ¡ dá»¯ liá»‡u cá»§a quan há»‡ con khi sá»­ dá»¥ng Soft Deletes (cascade delete)'
date: 2021-10-15T02:00:00Z
lastmod: '2021-10-15'
tags: ['laravel', 'package', 'guide']
draft: false
summary: 'Laravel cung cáº¥p cho báº¡n má»™t tÃ­nh nÄƒng Soft deletes ráº¥t há»¯u Ã­ch, tuy nhiÃªn nÃ³ láº¡i Ä‘i kÃ¨m vá»›i nhiá»u thá»­ thÃ¡ch, má»™t trong sá»‘ Ä‘Ã³ lÃ  xoÃ¡ cÃ¡c quan há»‡ con.'
layout: PostSimple
---

## Má»¥c lá»¥c

<TOCInline toc={props.toc} exclude="Má»¥c lá»¥c" toHeading={2} />

## Váº¥n Ä‘á» khi xoÃ¡ má»™t model khi sá»­ dá»¥ng Soft Deletes

Laravel cung cáº¥p cho báº¡n má»™t tÃ­nh nÄƒng Soft deletes ráº¥t há»¯u Ã­ch. Cho báº¡n nÃ o chÆ°a biáº¿t thÃ¬ Soft Deletes cÃ³ nghÄ©a lÃ  báº¡n khÃ´ng thá»±c sá»± xoÃ¡ má»™t dÃ²ng trong CSDL mÃ  chá»‰ Ä‘Ã¡nh dáº¥u "Ä‘Ã£ xoÃ¡" báº±ng cÃ¡ch thÃªm má»™t cá»™t dá»¯ liá»‡u.

VÃ­ dá»¥ ta cÃ³ trÆ°á»ng há»£p má»‘i quan há»‡ nhÆ° sau:

<S3Image src="/posts/xoa-du-lieu-quan-he-con-khi-su-dung-soft-delete/1.png" />

NhÆ° váº­y khi báº¡n xoÃ¡ má»™t Author (tÃ¡c giáº£), thÃ¬ báº¡n cÅ©ng pháº£i xoÃ¡ táº¥t cáº£ cÃ¡c Post (bÃ i viáº¿t) cá»§a tÃ¡c giáº£ Ä‘Ã³. Äá»‘i vá»›i trÆ°á»ng há»£p xoÃ¡ trá»±c tiáº¿p trÃªn CSDL thÃ¬ nhá»¯ng dÃ²ng cÃ³ khoÃ¡ ngoáº¡i cá»§a author_id cá»§a nÃ³ cÅ©ng tá»± Ä‘á»™ng xoÃ¡ theo.

## XoÃ¡ dá»¯ liá»‡u cá»§a cÃ¡c quan há»‡ con khi xoÃ¡ má»™t model

Báº¡n cÃ³ thá»ƒ thá»±c hiá»‡n viá»‡c nÃ y má»™t cÃ¡ch thá»§ cÃ´ng nhÆ° sau:

```php {6} showLineNumbers
class AuthorController extends Controller
{
		public function delete($id)
		{
				$author = Author::find($id);
				$author->post()->delete();
				$author->delete();
		}
}
```

NhÆ°ng náº¿u báº¡n cÃ³ nhiá»u hÆ¡n 1 quan há»‡ cáº§n xoÃ¡, Ä‘oáº¡n mÃ£ cá»§a báº¡n sáº½ báº¯t Ä‘áº§u dÃ i, chÃºng ta khÃ´ng nÃªn láº­p láº¡i má»™t Ä‘oáº¡n mÃ£ á»Ÿ nhiá»u nÆ¡i nhÆ° tháº¿ nÃ y.

Trong tÃ¬nh huá»‘ng nÃ y, báº¡n cÃ³ thá»ƒ chuyá»ƒn Ä‘oáº¡n code xá»­ lÃ½ nÃ y vÃ o Model vÃ  override method `delete()` cá»§a model `Author` nhÆ° sau:

```php {5} showLineNumbers
class Author extends Model
{
		public function delete()
    {
        $this->posts()->delete();
        parent::delete();
    }
}
```

## Tá»± Ä‘á»™ng xoÃ¡ dá»¯ liá»‡u cá»§a cÃ¡c quan há»‡ con

Package [dyrynda/laravel-cascade-soft-deletes](https://github.com/michaeldyrynda/laravel-cascade-soft-deletes) cung cáº¥p cho báº¡n má»™t cÃ¡ch dá»… dÃ ng hÆ¡n báº±ng cÃ¡ch chá»‰ cáº§n thÃªm trait `CascadeSoftDeletes` vÃ o Model vÃ  khai bÃ¡o biáº¿n `$cascadeDeletes` lÃ  máº£ng cÃ¡c quan há»‡ mÃ  báº¡n muá»‘n xoÃ¡ cÃ¹ng vá»›i nÃ³.

CÃ i Ä‘áº·t **dyrynda/laravel-cascade-soft-deletes**

```bash
$ composer require dyrynda/laravel-cascade-soft-deletes
```

ThÃªm vÃ o model `Author` cá»§a báº¡n:

```php {12,14} showLineNumbers
<?php

namespace App\Models;

use App\Models\Post;
use Dyrynda\Database\Support\CascadeSoftDeletes;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\SoftDeletes;

class Author extends Model
{
    use SoftDeletes, CascadeSoftDeletes;

    protected $cascadeDeletes = ['posts'];

    public function posts()
    {
        return $this->hasMany(Post::class);
    }
}
```

ÄÆ¡n giáº£n hÆ¡n ráº¥t nhiá»u Ä‘Ãºng khÃ´ng ğŸ˜ƒ

<BlogNewsletterForm title="Náº¿u báº¡n thÃ­ch nhá»¯ng bÃ i tháº¿ nÃ y?" />
