---
title: 'HÆ°á»›ng dáº«n setup Github action cho Laravel'
date: 2021-10-11T02:30:00Z
lastmod: '2021-10-11'
tags: ['laravel', 'guide']
draft: false
summary: 'CÃ¡ch Ä‘Æ¡n giáº£n Ä‘á»ƒ setup Github Action tá»± Ä‘á»™ng lÃ m cÃ¡c cÃ´ng viá»‡c  cháº¡y unit test, kiá»ƒm tra code style hay tháº­m chÃ­ deploy sáº£n pháº©m tá»± Ä‘á»™ng khi báº¡n push code lÃªn Github.'
layout: PostSimple
---

## Má»¥c lá»¥c

<TOCInline toc={props.toc} exclude="Má»¥c lá»¥c" toHeading={3} />

## Github Action lÃ  gÃ¬?

GitHub Actions lÃ  má»™t tÃ­nh nÄƒng cá»§a Github cho phÃ©p báº¡n cháº¡y nhá»¯ng dÃ²ng lá»‡nh Ä‘Æ°á»£c Ä‘áº·t trÆ°á»›c vÃ o má»™t thá»i Ä‘iá»ƒm nÃ o Ä‘Ã³ (vÃ­ dá»¥ push hay PR), má»¥c Ä‘Ã­ch thÆ°á»ng lÃ  Ä‘á»ƒ cháº¡y unit test, kiá»ƒm tra code style hay tháº­m chÃ­ deploy sáº£n pháº©m tá»± Ä‘á»™ng.

Trong bÃ i viáº¿t nÃ y mÃ¬nh sáº½ hÆ°á»›ng dáº«n cÃ¡ch Ä‘Æ¡n giáº£n Ä‘á»ƒ setup má»™t workflow (cÃ¡i mÃ¬nh vá»«a nÃ³i á»Ÿ trÃªn) khi cÃ³ ai Ä‘Ã³ push lÃªn code lÃªn repo nhÃ©.

Trong bÃ i viáº¿t nÃ y mÃ¬nh sáº½ dÃ¹ng cÃ¡c docker container cá»§a tá»« repo [https://github.com/kirschbaum-development/laravel-test-runner-container](https://github.com/kirschbaum-development/laravel-test-runner-container)

## CÃ i Ä‘áº·t Github Action Ä‘á»ƒ tá»± Ä‘á»™ng cháº¡y phpunit

### Táº¡o script workflow

Äáº§u tiÃªn báº¡n cáº§n táº¡o ra má»™t file cáº¥u hÃ¬nh trong thÆ° má»¥c dá»± Ã¡n, hÃ£y táº¡o file `.github/workflows/ci.yml` vá»›i ná»™i dung nhÆ° sau:

```yaml {7,9-17} showLineNumbers
on: push
name: CI
jobs:
  phpunit:
    runs-on: ubuntu-latest
    container:
      image: kirschbaumdevelopment/laravel-test-runner:7.3

    services:
      mysql:
        image: mysql:5.7
        env:
          MYSQL_ROOT_PASSWORD: password
          MYSQL_DATABASE: test
        ports:
          - 33306:3306
        options: --health-cmd="mysqladmin ping" --health-interval=10s --health-timeout=5s --health-retries=3

    steps:
      - uses: actions/checkout@v1
        with:
          fetch-depth: 1

      - name: Install composer dependencies
        run: |
          composer install --no-scripts

      - name: Prepare Laravel Application
        run: |
          cp .env.ci .env
          php artisan key:generate
          php artisan migrate:fresh --seed

      - name: Run Testsuite
        run: vendor/bin/phpunit tests/
```

Tuá»³ theo phiÃªn báº£n PHP cá»§a báº¡n, hÃ£y chá»n container image phÃ¹ há»£p:

- PHP 8.0: **`kirschbaumdevelopment/laravel-test-runner:8.0`**
- PHP 7.4: **`kirschbaumdevelopment/laravel-test-runner:7.4`**
- PHP 7.3: **`kirschbaumdevelopment/laravel-test-runner:7.3`**
- PHP 7.2: **`kirschbaumdevelopment/laravel-test-runner:7.2`**

### Cáº¥u hÃ¬nh biáº¿n mÃ´i trÆ°á»ng

Tiáº¿p theo báº¡n cáº§n táº¡o má»™t file cáº¥u hÃ¬nh biáº¿n mÃ´i trÆ°á»ng, hÃ£y copy file `.env.example` ra má»™t file má»›i vÃ  Ä‘áº·t tÃªn lÃ  `.env.ci`. Trong file nÃ y báº¡n chá»‰ cáº§n chÃº Ã½ Ä‘áº¿n chá»— cÃ i Ä‘áº·t cÃ¡c biáº¿n CSDL, Ä‘á»‘i vá»›i cÃ¡c báº¡n cháº¡y [MySQL](/blog/connect-laravel-with-mysql) thÃ¬ hÃ£y Ä‘á»•i láº¡i nhÆ° sau:

```{} showLineNumbers
# database
DB_CONNECTION=mysql
DB_HOST=mysql
DB_PORT=3306
DB_DATABASE=test
DB_USERNAME=root
DB_PASSWORD=password
```

Rá»“i bÃ¢y giá» hÃ£y commit láº¡i vÃ  push lÃªn Github xem nÃ o. Náº¿u báº¡n workflow cá»§a báº¡n hoáº¡t Ä‘á»™ng, báº¡n sáº½ tháº¥y má»™t dáº¥u cháº¥m trÃ²n bÃªn cáº¡nh thá»i gian commit cuá»‘i cÃ¹ng.

### Xem káº¿t quáº£ cháº¡y workflow

MÃ u vÃ ng ğŸŸ¡ lÃ  Ä‘ang cháº¡y, mÃ y xanh ğŸŸ¢ lÃ  thÃ nh cÃ´ng toÃ n bá»™. VÃ  táº¥t nhiÃªn, mÃ u Ä‘á» ğŸ”´ thÃ¬ cÃ³ gÃ¬ Ä‘Ã³ Ä‘Ã£ failed hÃ£y kiá»ƒm tra láº¡i.

<S3Image src="/posts/setup-github-action-for-unittest/1.png" />

## Cáº¥u hÃ¬nh Github Action sá»­ dá»¥ng PostgreSQL

Náº¿u dá»± Ã¡n cá»§a báº¡n Ä‘ang cháº¡y PostgreSQL thay vÃ¬ MySQL nhÆ° á»Ÿ trÃªn, báº¡n hÃ£y thay service trong file `ci.yml` láº¡i nhÆ° sau:

```yaml showLineNumbers
services:
  postgres:
    image: postgres:10.8
    env:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: test
    ports:
      - 5432:5432
    options: --health-cmd pg_isready --health-interval 10s --health-timeout 5s --health-retries 5
```

CÃ²n Ä‘Ã¢y lÃ  ná»™i dung cáº¥u hÃ¬nh biáº¿n mÃ´i trÆ°á»ng trong file `.env.ci`

```{} showLineNumbers
DB_CONNECTION=pgsql
DB_HOST=postgres
DB_PORT=5432
DB_DATABASE=test
DB_USERNAME=postgres
DB_PASSWORD=postgres
```

## Cáº¥u hÃ¬nh Github Action sá»­ dá»¥ng SQLite

SQLite cáº¥u hÃ¬nh ráº¥t Ä‘Æ¡n giáº£n, báº¡n hÃ£y xoÃ¡ luÃ´n `services` bÃªn trong file cáº¥u hÃ¬nh workflow, vÃ  sá»­a ná»™i dung `.env.ci` nhÆ° sau:

```{} showLineNumbers
DB_CONNECTION=sqlite
DB_DATABASE=:memory:
```

Náº¿u báº¡n thÃ­ch nhá»¯ng bÃ i viáº¿t nhÆ° tháº¿ nÃ y, hÃ£y Ä‘Äƒng kÃ½ nháº­n email hÃ ng tuáº§n, mÃ¬nh sáº½ tá»•ng há»£p cÃ¡c bÃ i viáº¿t hay trong tuáº§n vÃ  gá»­i email thÃ´ng bÃ¡o Ä‘áº¿n cÃ¡c báº¡n:

<BlogNewsletterForm title="ÄÄƒng kÃ½ nháº­n thÃ´ng bÃ¡o" />

Tham kháº£o: [Laravel Github Actions](https://laravel-news.com/laravel-github-actions)
